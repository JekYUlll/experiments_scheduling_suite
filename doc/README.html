<!DOCTYPE html><html><head>
      <title>README</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/zhangzhuyu/.vscode-server/extensions/shd101wyy.markdown-preview-enhanced-0.8.20/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="实验文档详细版">实验文档（详细版） </h1>
<p>本文件面向研究复现与学术交流，完整描述实验背景、设计、方法与结果，并在合适处引用已产出的图像结果。<br>
所有路径均以 <code>experiments_scheduling_suite/</code> 为根目录。</p>
<hr>
<h2 id="1-实验背景与问题定义">1. 实验背景与问题定义 </h2>
<p>极端环境下的气象与雪物理观测常受到传感器调度约束与不规则缺测的影响。<br>
本实验旨在系统评估：<strong>不同调度/缺失策略与不同插值算法的组合</strong>，在多种预测模型下对短时序列预测性能的影响。<br>
研究问题可表述为：</p>
<ol>
<li>缺失机制（调度策略）如何影响模型性能与稳定性？</li>
<li>插值策略在不同缺失模式下的表现差异是否显著？</li>
<li>不同模型（深度/传统/基线）对缺失结构的敏感度是否一致？</li>
<li>在“事件段”与“非事件段”上的误差分布是否具有结构性差异？</li>
</ol>
<p>本实验采用合成的 wind-blown snow 数据作为标准化测试基准，提供可控的频率与缺失机制以支持系统性比较。</p>
<hr>
<h2 id="2-数据与合成流程">2. 数据与合成流程 </h2>
<p>实验数据由脚本 <a href="../scripts/00_generate_data.py"><code>scripts/00_generate_data.py</code></a> 生成（默认 synthetic wind-blown snow），包含风速、温湿度、气压、雪粒径/速度分箱通量等多变量观测。<br>
数据被重采样至 <code>base_freq</code>（默认 1s），并进行特征工程：</p>
<ul>
<li>风向角转为 <code>sin/cos</code> 两个分量</li>
<li>稳定度标记转为 one-hot</li>
</ul>
<h3 id="21-合成数据生成规则关键机制">2.1 合成数据生成规则（关键机制） </h3>
<p>合成数据生成器位于：<a href="../src/data/generator/synthetic_windblown.py"><code>src/data/generator/synthetic_windblown.py</code></a>，核心规则如下：</p>
<ul>
<li><strong>时间网格</strong>：固定步长（默认 1s），生成规则时间序列。</li>
<li><strong>动态平滑</strong>：关键气象变量采用带步长缩放的 AR(1) 过程，保证短时连续性。</li>
<li><strong>日变化</strong>：温度/风速/辐射包含正弦日周期项。</li>
<li><strong>风暴状态</strong>：二态马尔可夫过程（storm_state）控制风速抬升、降水增强、辐射衰减。</li>
<li><strong>输运阈值</strong>：使用经验阈值 <code>Ut</code> 与风速计算超越程度 <code>ratio</code>，决定雪输运强度。</li>
<li><strong>供给反馈</strong>：<code>snow_supply</code> 随降水增加、随输运消耗；影响最终雪通量。</li>
<li><strong>质量/数目通量</strong>：先生成总雪质量通量，再按粒径/速度分箱用 Dirichlet 分配，确保守恒。</li>
<li><strong>观测质量字段</strong>：<code>quality_flag</code>、<code>data_source</code>、<code>missing_reason</code> 仅作为元信息；在数值化阶段会被丢弃。</li>
</ul>
<blockquote>
<p>该设计确保序列既平滑可学，又包含风暴事件与输运阈值带来的非线性变化。</p>
</blockquote>
<h3 id="22-可用变量与处理约束">2.2 可用变量与处理约束 </h3>
<p>输入 CSV 至少需要包含：<br>
<code>timestamp, air_temperature_c, relative_humidity, air_pressure_pa, wind_speed_ms, wind_direction_deg, solar_radiation_wm2, snow_mass_flux_kg_m2_s, snow_number_flux_m2_s</code></p>
<p>注意事项：</p>
<ul>
<li>所有<strong>非数值列</strong>会在 <code>_select_numeric</code> 阶段（见 <a href="../scripts/01_prepare_dataset.py"><code>scripts/01_prepare_dataset.py</code></a>）被转换/剔除。</li>
<li>若某列全部为 NaN，会被直接删除，避免插补后仍为 NaN。</li>
<li>目标列默认 <strong>始终可观测</strong>（由 missingness 配置 <code>target_always_observed</code> 控制）。</li>
</ul>
<p>示例的缺失热图可查看：<br>
<a href="../reports/synthetic_windblown_1s_mcar_p0.2_linear/figures/pretrain/missingness_heatmap.png"><code>../reports/synthetic_windblown_1s_mcar_p0.2_linear/figures/pretrain/missingness_heatmap.png</code></a></p>
<p><img src="../reports/synthetic_windblown_1s_mcar_p0.2_linear/figures/pretrain/missingness_heatmap.png" alt="Missingness heatmap"></p>
<blockquote>
<p>图中每个像素表示“时间×变量”的观测状态（黑=观测，白=缺失）。<br>
当时间点过多时会自动按 <code>max_time_points</code> 下采样，并按列分面展示以减少标签拥挤。</p>
</blockquote>
<hr>
<h2 id="3-实验设计">3. 实验设计 </h2>
<h3 id="31-全量因子设计">3.1 全量因子设计 </h3>
<p>本实验采用<strong>全量组合</strong>设计：</p>
<ul>
<li>调度/缺失策略（Missingness）</li>
<li>插值算法（Imputation）</li>
<li>预测模型（Model）</li>
<li>预测步长（Horizon）</li>
</ul>
<p>每个组合产生一个 <code>run_id</code>，其结构为：<br>
<code>{dataset}_{freq}_{missingness}{params}_{imputer}</code></p>
<p>例如：<br>
<code>synthetic_windblown_1s_mcar_p0.2_linear</code></p>
<h3 id="32-数据处理流程">3.2 数据处理流程 </h3>
<ol>
<li>缺失模拟（按策略生成 mask）</li>
<li>插值（或 mask-aware 衍生特征）</li>
<li>归一化（仅用训练集统计量）</li>
<li>窗口化（lookback + horizons）</li>
</ol>
<h3 id="33-训练与评估">3.3 训练与评估 </h3>
<p>训练脚本：<a href="../scripts/03_train_models.py"><code>scripts/03_train_models.py</code></a><br>
评估脚本：<a href="../scripts/04_evaluate.py"><code>scripts/04_evaluate.py</code></a></p>
<p>指标包括：</p>
<ul>
<li>RMSE</li>
<li>MAE</li>
<li>MAPE</li>
</ul>
<p>此外还有：</p>
<ul>
<li>事件段 vs 非事件段误差对比</li>
<li>缺失结构 vs 误差散点相关</li>
<li>排名一致性与敏感性分析</li>
</ul>
<hr>
<h2 id="4-调度缺失策略missingness">4. 调度/缺失策略（Missingness） </h2>
<h3 id="41-调度缺失策略实现细节">4.1 调度/缺失策略实现细节 </h3>
<p>实现路径：<a href="../src/missingness/"><code>src/missingness/</code></a>。记 x_t^j 为第 j 个传感器在时间 t 的观测值，<br>
定义观测指示变量 m_t^j ∈ {0,1}（1=观测，0=缺失）。默认设置 m_t^target=1（<code>target_always_observed=true</code>），<br>
即目标列始终可观测。</p>
<ul>
<li>
<p><strong>MCAR</strong>（<a href="../src/missingness/mcar.py"><code>mcar.py</code></a>）：<br>
在统计上对应 Missing Completely At Random 机制。对每个传感器 j，m_t^j 按 Bernoulli(1-p_j) 抽样，<br>
并假设与时间、变量及真实值独立。<code>p_missing</code> 提供全局缺失率，<code>per_variable</code> 可指定每列缺失率。<br>
该机制生成时间独立、跨变量独立的缺失图样，是“无结构缺失”的基线。</p>
</li>
<li>
<p><strong>Block</strong>（<a href="../src/missingness/block.py"><code>block.py</code></a>）：<br>
通过显式生成连续缺失区间模拟设备故障或通信中断。对每个变量生成 n_blocks 段区间，<br>
缺失长度在 [min_len_steps, max_len_steps] 内均匀采样。若 <code>per_variable=false</code>，<br>
同一缺失块对所有变量同步生效，形成跨变量相关缺失。该机制引入强时间自相关与长缺口分布，<br>
明显偏离 MCAR 假设。</p>
</li>
<li>
<p><strong>Duty Cycle</strong>（<a href="../src/missingness/duty_cycle.py"><code>duty_cycle.py</code></a>）：<br>
周期性开关采样（硬件占空比模型）。对每个变量设定周期 P 与开启时长 O，<br>
m_t^j 在每个周期内仅有 O 步为观测（相位可随机）。可选 <code>budget_k</code> 对同一时刻开启数进行截断，<br>
使观测预算与占空比同时约束。该机制生成强周期结构的缺失模式。</p>
</li>
<li>
<p><strong>Round Robin</strong>（<a href="../src/missingness/round_robin.py"><code>round_robin.py</code></a>）：<br>
预算约束的轮询调度。以 <code>min_on_steps</code> 为块长度，在每个块内选择 <code>budget_k</code> 个传感器按 <code>sensor_order</code> 轮换开启，<br>
其余关闭。该策略保证长期公平覆盖，同时在任意时刻只保留预算内变量，缺失在变量间呈现结构性互斥。</p>
</li>
<li>
<p><strong>Info Priority</strong>（<a href="../src/missingness/info_priority.py"><code>info_priority.py</code></a>）：<br>
数据驱动的启发式调度。先在训练集上计算权重 w_j = max_lag |corr(x_{t-lag}^j, y_t)|（<code>lag_steps</code>），<br>
再在每个调度块内选取权重最高的 top-k 变量。可选 <code>refresh_steps</code> 周期性更新权重。<br>
该机制模拟“信息优先级”采样，缺失分布与目标相关性耦合，但使用训练集权重以避免信息泄露。</p>
</li>
</ul>
<p>统一约束：</p>
<ul>
<li>缺失 mask 仅作用于输入传感器；目标列是否缺失由 <code>target_always_observed</code> 控制。</li>
<li>缺失 mask 在插补前应用，确保插补算法在相同缺失条件下比较。</li>
</ul>
<p>示例：不同 missingness 家族的敏感性曲线<br>
<a href="../reports/_aggregate/figures/sensitivity_mcar_H1.png"><code>../reports/_aggregate/figures/sensitivity_mcar_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/sensitivity_block_H1.png"><code>../reports/_aggregate/figures/sensitivity_block_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/sensitivity_duty_cycle_H1.png"><code>../reports/_aggregate/figures/sensitivity_duty_cycle_H1.png</code></a></p>
<p><img src="../reports/_aggregate/figures/sensitivity_mcar_H1.png" alt="Sensitivity mcar"><br>
<img src="../reports/_aggregate/figures/sensitivity_block_H1.png" alt="Sensitivity block"><br>
<img src="../reports/_aggregate/figures/sensitivity_duty_cycle_H1.png" alt="Sensitivity duty_cycle"></p>
<blockquote>
<p>这些曲线展示在同一 missingness 家族内，参数变化对误差的影响趋势。</p>
</blockquote>
<hr>
<h2 id="5-插值算法imputation">5. 插值算法（Imputation） </h2>
<h3 id="51-插值算法实现细节">5.1 插值算法实现细节 </h3>
<p>实现路径：<a href="../src/imputation/"><code>src/imputation/</code></a>。设观测序列为 x_t^j，缺失位置由 m_t^j 标记，插值目标为估计缺失值 x_t^j。</p>
<ul>
<li>
<p><strong>Mask-aware</strong>（<a href="../src/imputation/maskaware_features.py"><code>maskaware_features.py</code></a>）：<br>
将缺失问题转化为“缺失建模”而非显式插值。具体地，保留原缺失模式，<br>
并引入 is_missing 与 time-since-last-seen（TSLS）特征作为额外输入。<br>
该方法相当于在模型中显式表示缺失机制，使模型在预测时能利用缺失结构信息。</p>
</li>
<li>
<p><strong>Linear</strong>（<a href="../src/imputation/linear.py"><code>linear.py</code></a>）：<br>
对每个变量按时间序列进行线性插值，边界使用前向/后向填充。<br>
该策略等价于在缺失区间内假设局部线性变化，是最常用的低偏差基线。</p>
</li>
<li>
<p><strong>Spline</strong>（<a href="../src/imputation/spline.py"><code>spline.py</code></a>）：<br>
使用三次样条（order=3）进行平滑插值，试图恢复更高阶的连续性。<br>
当有效样本不足时退化为线性插值以保证数值稳定；插值结果会裁剪到观测值范围以抑制过冲。</p>
</li>
<li>
<p><strong>Kalman</strong>（<a href="../src/imputation/kalman.py"><code>kalman.py</code></a>）：<br>
逐变量使用局部水平状态空间模型进行一维 Kalman 滤波/平滑。<br>
其本质是最小均方估计（MMSE）意义下对噪声和动态进行权衡，<br>
适合平稳或弱趋势序列的缺失补全。</p>
</li>
<li>
<p><strong>GP</strong>（<a href="../src/imputation/gp.py"><code>gp.py</code></a>）：<br>
使用高斯过程回归（RBF + WhiteKernel）对每个变量进行非参数插值。<br>
该方法可表达非线性变化，但计算代价较高；当样本过少时回退线性插值。</p>
</li>
</ul>
<blockquote>
<p>注意：在插补前，所有非数值列会被剔除；全为 NaN 的列也会被直接丢弃。</p>
</blockquote>
<p>示例：插值误差评估（如有生成）可在：<br>
<a href="../reports/_aggregate/tables/imputation_error_long.csv"><code>../reports/_aggregate/tables/imputation_error_long.csv</code></a></p>
<hr>
<h2 id="6-预测模型model">6. 预测模型（Model） </h2>
<h3 id="61-任务定义与特征构建">6.1 任务定义与特征构建 </h3>
<p>本实验采用多步监督学习形式：给定长度为 <code>lookback</code> 的历史窗口，预测未来多步目标值。<br>
默认目标变量为 <code>wind_speed_ms</code>（可在 <a href="../configs/base.yaml"><code>configs/base.yaml</code></a> 的 <code>run.target</code> 中修改）。</p>
<ul>
<li><strong>输入特征</strong>：重采样后的所有数值传感器变量（包含目标变量的历史轨迹），见 <a href="../scripts/01_prepare_dataset.py"><code>scripts/01_prepare_dataset.py</code></a>。
<ul>
<li>可选特征工程：风向 <code>sin/cos</code> 分量与稳定度 one-hot（<code>features.use_wind_dir_sincos</code> / <code>features.onehot_stability_flag</code>）。</li>
<li>若使用 Mask-aware 插补，会额外加入 <code>is_missing_*</code> 与 <code>tsls_*</code> 特征。</li>
</ul>
</li>
<li><strong>标准化</strong>：仅使用训练集统计量对输入特征进行标准化（<code>normalize.method=standard</code>）。</li>
<li><strong>输出形式</strong>：直接多步预测，输出向量对应 <code>horizons=[1,2,3]</code>。</li>
</ul>
<h3 id="62-模型家族与结构简介全称与功能">6.2 模型家族与结构简介（全称与功能） </h3>
<ul>
<li><strong>Naive Persistence Baseline（持久性基线）</strong>：<br>
假设短期内状态不变，预测 ŷ(t+h)=y(t)。用于衡量“不可忽略的最低基线”。</li>
<li><strong>MLP (Multi-Layer Perceptron)</strong>：<br>
将时间窗口展平为向量后进行多输出回归，适合作为弱非线性基线。</li>
<li><strong>TCN (Temporal Convolutional Network)</strong>：<br>
因果膨胀卷积 + 残差结构，能够在固定感受野内捕捉长依赖。</li>
<li><strong>LSTM (Long Short-Term Memory)</strong>：<br>
循环网络模型，利用门控机制建模长短期依赖；输出取最后时刻隐藏状态。</li>
<li><strong>Transformer (Encoder-only)</strong>：<br>
基于自注意力的序列建模，采用位置编码与多头注意力捕捉全局依赖。</li>
<li><strong>Informer (Informer: Beyond Efficient Transformer for Long Sequence Time-Series Forecasting)</strong>：<br>
本实验采用简化实现，加入下采样（distilling）以减少序列长度并提高效率。</li>
<li><strong>XGBoost (Extreme Gradient Boosting)</strong>：<br>
树模型的梯度提升方法，对每个 horizon 独立拟合回归器，适合强特征基线比较。</li>
</ul>
<h3 id="63-参数设置与训练策略">6.3 参数设置与训练策略 </h3>
<ul>
<li><strong>模型超参</strong>：来自 <a href="../configs/models/"><code>configs/models/</code></a>；例如 LSTM 的 <code>hidden_size/num_layers/dropout</code>，<br>
Transformer/Informer 的 <code>d_model/nhead/num_layers/dim_feedforward</code> 等。</li>
<li><strong>训练超参</strong>：来自 <a href="../configs/base.yaml"><code>configs/base.yaml</code></a> 的 <code>training</code> 部分：<br>
<code>epochs=10</code>、<code>batch_size=64</code>、<code>lr=1e-3</code>、<code>weight_decay=0</code>、默认 CPU。</li>
<li><strong>优化与损失</strong>：神经模型使用 Adam + MSELoss；XGBoost/MLP 使用各自库的默认优化策略。</li>
<li><strong>可复现性</strong>：统一使用固定随机种子（<code>run.seed</code>）。</li>
</ul>
<blockquote>
<p>所有模型输出均为多步预测（H=1/2/3），用于跨策略与插补方法的统一对比。</p>
</blockquote>
<h2 id="7-结果展示与分析">7. 结果展示与分析 </h2>
<h3 id="70-结果简要观察基于当前生成图">7.0 结果简要观察（基于当前生成图） </h3>
<p>以下观察基于 <a href="../reports/_aggregate/figures"><code>reports/_aggregate/figures</code></a> 的默认汇总图（H=1 为例）：</p>
<ul>
<li><strong>整体误差分布</strong>：见 <a href="../reports/_aggregate/figures/boxplot_H1.png"><code>../reports/_aggregate/figures/boxplot_H1.png</code></a> / <code>H2/H3</code>，<br>
随预测步长增大，中位数整体上升且箱体变宽，说明不确定性随 horizon 增加。</li>
<li><strong>事件段 vs 非事件段</strong>：见 <a href="../reports/_aggregate/figures/event_vs_nonevent_H1.png"><code>../reports/_aggregate/figures/event_vs_nonevent_H1.png</code></a>，<br>
事件段 RMSE 略高于非事件段，且 H 越大差距越明显。</li>
<li><strong>MCAR 敏感性</strong>：见 <a href="../reports/_aggregate/figures/sensitivity_mcar_H1.png"><code>../reports/_aggregate/figures/sensitivity_mcar_H1.png</code></a>，<br>
TCN 对缺失率上升更敏感；Naive/XGBoost 相对稳定但在高缺失率出现回升。</li>
<li><strong>Block 敏感性</strong>：见 <a href="../reports/_aggregate/figures/sensitivity_block_H1.png"><code>../reports/_aggregate/figures/sensitivity_block_H1.png</code></a>，<br>
block 长度增大时误差上界提高，说明长缺口对模型更不利。</li>
<li><strong>Duty-cycle 敏感性</strong>：见 <a href="../reports/_aggregate/figures/sensitivity_duty_cycle_H1.png"><code>../reports/_aggregate/figures/sensitivity_duty_cycle_H1.png</code></a>，<br>
不同占空比对误差存在非线性影响，部分模型在中等占空比达到更低误差。</li>
<li><strong>Round-robin 敏感性</strong>：见 <a href="../reports/_aggregate/figures/sensitivity_round_robin_H1.png"><code>../reports/_aggregate/figures/sensitivity_round_robin_H1.png</code></a>，<br>
预算 k 增大时 Informer 误差下降更明显，表明对“观测数量”更敏感。</li>
<li><strong>Info-priority</strong>：见 <a href="../reports/_aggregate/figures/sensitivity_info_priority_H1.png"><code>../reports/_aggregate/figures/sensitivity_info_priority_H1.png</code></a>，<br>
当前 sweep 仅包含单一参数点（k=3），曲线退化为竖线，建议扩展参数栅格。</li>
<li><strong>热力图</strong>：见 <a href="../reports/_aggregate/figures/heatmap_informer_H1.png"><code>../reports/_aggregate/figures/heatmap_informer_H1.png</code></a> 与<br>
<a href="../reports/_aggregate/figures/heatmap_lstm_H1.png"><code>../reports/_aggregate/figures/heatmap_lstm_H1.png</code></a>，<br>
info_priority_k3_minon3 在多数插补下颜色更冷，表现更稳；<br>
round_robin 低 k + spline 的组合更容易出现较高误差。</li>
<li><strong>排名一致性</strong>：见 <a href="../reports/_aggregate/figures/rank_corr_heatmap_H1.png"><code>../reports/_aggregate/figures/rank_corr_heatmap_H1.png</code></a>，<br>
同一策略家族内部相关性高，跨家族（如 block vs round_robin）一致性较低。</li>
</ul>
<blockquote>
<p>注意：以上为定性观察，严谨结论需结合统计显著性检验与更长序列。</p>
</blockquote>
<h3 id="71-汇总图overview">7.1 汇总图（overview） </h3>
<p>整体汇总图可见：<br>
<a href="../reports/_aggregate/figures/posthoc_overview.png"><code>../reports/_aggregate/figures/posthoc_overview.png</code></a></p>
<p><img src="../reports/_aggregate/figures/posthoc_overview.png" alt="Overview"></p>
<p>该图汇总了模型总体表现与缺失结构的影响趋势。</p>
<h3 id="72-模型热力图策略--插值">7.2 模型热力图（策略 × 插值） </h3>
<p>以 Informer 为例（H=1/2/3）：<br>
<a href="../reports/_aggregate/figures/heatmap_informer_H1.png"><code>../reports/_aggregate/figures/heatmap_informer_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/heatmap_informer_H2.png"><code>../reports/_aggregate/figures/heatmap_informer_H2.png</code></a><br>
<a href="../reports/_aggregate/figures/heatmap_informer_H3.png"><code>../reports/_aggregate/figures/heatmap_informer_H3.png</code></a></p>
<p><img src="../reports/_aggregate/figures/heatmap_informer_H1.png" alt="Heatmap informer H1"></p>
<p>热力图展示 “Missingness × Imputation” 的组合效应。</p>
<h3 id="73-boxplot跨策略误差分布">7.3 Boxplot（跨策略误差分布） </h3>
<p><a href="../reports/_aggregate/figures/boxplot_H1.png"><code>../reports/_aggregate/figures/boxplot_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/boxplot_H2.png"><code>../reports/_aggregate/figures/boxplot_H2.png</code></a><br>
<a href="../reports/_aggregate/figures/boxplot_H3.png"><code>../reports/_aggregate/figures/boxplot_H3.png</code></a></p>
<p><img src="../reports/_aggregate/figures/boxplot_H1.png" alt="Boxplot H1"></p>
<p>该图可用于观察不同策略组合的总体误差分布与离群点。</p>
<h3 id="74-散点相关缺失结构-vs-误差">7.4 散点相关（缺失结构 vs 误差） </h3>
<p><a href="../reports/_aggregate/figures/scatter_max_gap_len_H1.png"><code>../reports/_aggregate/figures/scatter_max_gap_len_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/scatter_p95_gap_len_H1.png"><code>../reports/_aggregate/figures/scatter_p95_gap_len_H1.png</code></a><br>
<a href="../reports/_aggregate/figures/scatter_co_missingness_mean_H1.png"><code>../reports/_aggregate/figures/scatter_co_missingness_mean_H1.png</code></a></p>
<p><img src="../reports/_aggregate/figures/scatter_max_gap_len_H1.png" alt="Scatter max gap"><br>
<img src="../reports/_aggregate/figures/scatter_p95_gap_len_H1.png" alt="Scatter p95 gap"><br>
<img src="../reports/_aggregate/figures/scatter_co_missingness_mean_H1.png" alt="Scatter co-missing"></p>
<p>该类图用于分析缺失结构特征与预测误差之间的相关性趋势。</p>
<h3 id="75-排名相关策略一致性">7.5 排名相关（策略一致性） </h3>
<p><a href="../reports/_aggregate/figures/rank_corr_heatmap_H1.png"><code>../reports/_aggregate/figures/rank_corr_heatmap_H1.png</code></a></p>
<p><img src="../reports/_aggregate/figures/rank_corr_heatmap_H1.png" alt="Rank corr"></p>
<p>展示各策略组合在模型排名上的一致性。</p>
<h3 id="76-事件段-vs-非事件段">7.6 事件段 vs 非事件段 </h3>
<p><a href="../reports/_aggregate/figures/event_vs_nonevent_H1.png"><code>../reports/_aggregate/figures/event_vs_nonevent_H1.png</code></a></p>
<p><img src="../reports/_aggregate/figures/event_vs_nonevent_H1.png" alt="Event vs non-event"></p>
<p>该图用于比较事件段与非事件段的误差差异（具体事件定义见脚本参数）。</p>
<h3 id="77-跨策略预测曲线对比">7.7 跨策略预测曲线对比 </h3>
<p>以 Informer (H=1) 为例：<br>
<a href="../reports/_aggregate/figures/strategy_preds/informer_h1.png"><code>../reports/_aggregate/figures/strategy_preds/informer_h1.png</code></a></p>
<p><img src="../reports/_aggregate/figures/strategy_preds/informer_h1.png" alt="Strategy comparison informer H1"></p>
<p>颜色代表插值算法，线型代表调度策略，黑色为真实值。</p>
<hr>
<h2 id="8-可复现流程">8. 可复现流程 </h2>
<p>单次实验（示例）：</p>
<p>相关脚本：<a href="../scripts/00_generate_data.py"><code>00_generate_data.py</code></a>、<a href="../scripts/01_prepare_dataset.py"><code>01_prepare_dataset.py</code></a>、<a href="../scripts/03_train_models.py"><code>03_train_models.py</code></a></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>PYTHONPATH=/home/zhangzhuyu/_code/microclimate_demo \
python experiments_scheduling_suite/scripts/00_generate_data.py \
  --config experiments_scheduling_suite/configs/base.yaml \
  --dataset experiments_scheduling_suite/configs/datasets/synthetic.yaml

PYTHONPATH=/home/zhangzhuyu/_code/microclimate_demo \
python experiments_scheduling_suite/scripts/01_prepare_dataset.py \
  --config experiments_scheduling_suite/configs/base.yaml \
  --dataset experiments_scheduling_suite/configs/datasets/synthetic.yaml \
  --missingness experiments_scheduling_suite/configs/missingness/mcar.yaml \
  --imputation experiments_scheduling_suite/configs/imputation/linear.yaml

PYTHONPATH=/home/zhangzhuyu/_code/microclimate_demo \
python experiments_scheduling_suite/scripts/03_train_models.py --run-id &lt;RUN_ID&gt;
</code></pre><p>全量实验（建议在 tmux 中运行）：</p>
<p>脚本：<a href="../scripts/run_full_sweep.sh"><code>run_full_sweep.sh</code></a></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>bash experiments_scheduling_suite/scripts/run_full_sweep.sh
</code></pre><hr>
<h2 id="9-讨论与局限">9. 讨论与局限 </h2>
<ol>
<li><strong>合成数据偏差</strong>：合成分布与真实观测仍有差距。</li>
<li><strong>插值过冲风险</strong>：样条插值在稀疏缺失时可能出现过冲或不稳定。</li>
<li><strong>短步长高重合</strong>：在 H=1/2/3 的短步长下，持久性基线可能非常强。</li>
<li><strong>事件定义敏感</strong>：事件段划分依赖阈值定义，影响对比结果。</li>
</ol>
<hr>
<h2 id="10-后续扩展建议">10. 后续扩展建议 </h2>
<ul>
<li>引入真实站点数据作为外部验证</li>
<li>增加更长的预测 horizon</li>
<li>增加物理约束或多任务损失</li>
<li>进行缺失结构的可解释性分析（如 SHAP、因果扰动）</li>
</ul>
<hr>
<h2 id="11-参考输出路径索引便于检索">11. 参考输出路径索引（便于检索） </h2>
<ul>
<li>预训练可视化：<code>../reports/&lt;RUN_ID&gt;/figures/pretrain/</code></li>
<li>预测输出：<code>../reports/&lt;RUN_ID&gt;/preds/</code></li>
<li>单次总结图：<code>../reports/&lt;RUN_ID&gt;/figures/summary_&lt;RUN_ID&gt;.png</code></li>
<li>聚合分析：<a href="../reports/_aggregate/figures/"><code>../reports/_aggregate/figures/</code></a></li>
</ul>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>